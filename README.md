# Auto Highlight Extractor (V5: Event-Log Architecture)

ì´ˆì¥ë¬¸(12ì‹œê°„+) ì‹¤ì‹œê°„ ë°©ì†¡ ì˜ìƒ ì²˜ë¦¬ì— ìµœì í™”ëœ **'ì´ë²¤íŠ¸ ë¡œê·¸ ê¸°ë°˜ í•˜ì´ë¸Œë¦¬ë“œ ìë™ í¸ì§‘ê¸°'**ì…ë‹ˆë‹¤.  
ë‹¨ìˆœí•œ ìš”ì•½ì„ ë„˜ì–´, ì˜ìƒì˜ êµ¬ì¡°ì  ìƒíƒœ ë³€í™”ì™€ ëŒ€í™” ë°€ë„ë¥¼ ë¶„ì„í•˜ì—¬ ìµœê³ ì˜ ì¥ë©´ì„ Map-Reduce ë°©ì‹ìœ¼ë¡œ ì¶”ì¶œí•©ë‹ˆë‹¤.

---

## ğŸ—ï¸ V5 ì•„í‚¤í…ì²˜ (Map-Reduce Ranking)

V5ëŠ” ìš”ì•½ì˜ í•œê³„ë¥¼ ê·¹ë³µí•˜ê¸° ìœ„í•´ **'ìƒíƒœ ë³€í™” ê°ì§€(State Transition Detection)'**ì™€ **'í™”ë²• ë°€ë„(Speech Density)'**ë¥¼ í•µì‹¬ ì§€í‘œë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

### 1ï¸âƒ£ ì‘ë™ ì›ë¦¬ (The V5 Pipeline)

#### **Step 0: State Transition Mapping (Map Phase)**
- **ì—­í• **: ì˜ìƒ ì „ì²´ì˜ 'êµ¬ì¡°ì  ëœë“œë§ˆí¬' ë¡œê·¸ ì¶”ì¶œ
- **ë°©ì‹**: 
    1. ëŒ€ë³¸ì„ ì²­í¬ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ì–´ ì œë¯¸ë‚˜ì´ê°€ **[ê²Œì„ ì‹œì‘/ì¢…ë£Œ/ë¦¬ì…‹, ì£¼ì œ ì „í™˜, ê°ì • í­ë°œ]** ë¡œê·¸ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.
    2. ì„¤ëª… ëŒ€ì‹  `{"time": 120.5, "event": "Boss Fight Start", "importance": 9}` í˜•ì‹ì˜ JSON ë¡œê·¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
- **ì•ˆì •ì„±**: ì²­í¬ ì¤‘ ì¼ë¶€ê°€ ì‹¤íŒ¨í•˜ë”ë¼ë„ ë©ˆì¶”ì§€ ì•Šê³  ë‹¤ìŒ ì²­í¬ë¡œ ë„˜ì–´ê°€ ì™„ìˆ˜ìœ¨ì„ ë³´ì¡´í•©ë‹ˆë‹¤.

#### **Step 1: Global Filter & Ranking (Filter Phase)**
- **ì—­í• **: ìˆ˜ë§ì€ í›„ë³´ ì¤‘ ê°€ì¥ ìœ ë ¥í•œ **TOP 15** ì„ ë³„
- **ì§€í‘œ**:
    - **Event Match**: ì¶”ì¶œëœ ì´ë²¤íŠ¸ ë¡œê·¸ì˜ ì¤‘ìš”ë„
    - **Visual/Signal Peak**: ì˜¤ë””ì˜¤ ë° ì‹œê°ì  ì—ë„ˆì§€ì˜ ê³ ì 
    - **Speech Density**: (New) ë¶„ë‹¹ ê¸€ì ìˆ˜ ë¶„ì„ì„ í†µí•œ 'ì˜¤ë””ì˜¤ ê½‰ ì°¸' ì •ë„ ì¸¡ì •
- **ê³µì‹**:  
  $$Score_{final} = (Event\_Match \times 0.4) + (Signal\_Peak \times 0.3) + (Speech\_Density \times 0.3)$$

#### **Step 2: Precision Evaluation (Reduce Phase)**
- **ì—­í• **: ì„ ì •ëœ 15ê°œ í›„ë³´ ì»·ì— ëŒ€í•œ ì œë¯¸ë‚˜ì´ ì‹¬ì‚¬ìœ„ì›ì˜ ì •ë°€ í‰ê°€
- **ëª¨ë¸**: **Gemini 1.5 Flash** (í•˜ë“œì½”ë”© ìˆ˜ì¤€ì˜ ê³ ì •ìœ¼ë¡œ 404 ì—ëŸ¬ ì›ì²œ ì°¨ë‹¨)
- **ê²€ì¦**: `info_density`(ìƒí™© íŒŒí™© ê°€ëŠ¥ ì—¬ë¶€)ì™€ `narrative_payoff`(ì„œì‚¬ì  ë³´ìƒ)ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ ê²€í† í•©ë‹ˆë‹¤.

#### **Step 3: Narrative Production (V4 Polish)**
- **ì—­í• **: í•˜ì´ë¼ì´íŠ¸ ì˜í™”(Highlight Movie) ì™„ì„±
- **ê¸°ëŠ¥**: **ì±•í„° íƒ€ì´í‹€ ì¹´ë“œ**, **ë¸Œë¦¿ì§€ í…ìŠ¤íŠ¸**, **ìë§‰(Burn-in)** í•©ì„± ë° ë¬´ì†ì‹¤ êµì°¨ í¸ì§‘ ë³‘í•©.

---

## ğŸ› ï¸ ì£¼ìš” ì—…ë°ì´íŠ¸ (V5 Emergency Pack)

- **404 ì—ëŸ¬ ë°•ë©¸**: ëª¨ë¸ ëª…ì¹­ì—ì„œ `models/` ì ‘ë‘ì‚¬ë¥¼ ì™„ì „íˆ ì œê±°í•˜ê³  `gemini-1.5-flash`ë¡œ í•˜ë“œì½”ë”© ê³ ì •.
- **íˆ¬ëª…í•œ ë””ë²„ê¹…**: ëª¨ë“  API í˜¸ì¶œ ì‹œ í„°ë¯¸ë„ì— `DEBUG: Current Model ID -> ...`ë¥¼ ì¶œë ¥í•˜ì—¬ ì „ì†¡ ìƒíƒœë¥¼ ê°€ì‹œí™”.
- **Quota Safety**: ëª¨ë“  í˜¸ì¶œ ì‚¬ì´ì— **2ì´ˆ ì´ìƒì˜ ê°•ì œ ëŒ€ê¸° ì‹œê°„**ì„ ì‚½ì…í•˜ì—¬ 429 ì—ëŸ¬ ë°©ì§€.
- **Force Refresh**: `--force-refresh` ì˜µì…˜ìœ¼ë¡œ ì˜¤ì—¼ëœ ì²´í¬í¬ì¸íŠ¸ë¥¼ ë¬´ì‹œí•˜ê³  ì‹ ì„ í•œ ë¶„ì„ ì‹œì‘ ê°€ëŠ¥.

---

## ğŸ“‚ ì‹¤í–‰ ë°©ë²•

```bash
# V5 ì—”ì§„ìœ¼ë¡œ ì‹¤í–‰ (ì´ë²¤íŠ¸ ë¡œê·¸ ê¸°ë°˜ ìƒìœ„ 4ê°œ ì±•í„°ê¸‰ ì¥ë©´ ì¶”ì¶œ)
python factory_main.py "raw_data/poong.mp4" --force-refresh --chapters 4

# íŠ¹ì • ìŠ¤íƒ€ì¼ í”„ë¦¬ì…‹ ì ìš©
python factory_main.py "raw_data/poong.mp4" --preset "presets/poong"
```

---

## ğŸ“‚ í´ë” êµ¬ì¡° (Core Files)

- `factory_main.py`: [V5] ì‹ ê·œ Map-Reduce íŒŒì´í”„ë¼ì¸ ì œì–´ê¸°
- `hybrid_agent_v2/story_architect.py`: [New] ìƒíƒœ ë³€í™” ë¡œê·¸ ë° ì±•í„° ë­í‚¹ ì—”ì§„
- `hybrid_agent_v2/knowledge_base.py`: [New] í™”ë²• ë°€ë„ ë° ì •ì  êµ¬ê°„ ë¶„ì„/ì €ì¥
- `hybrid_agent_v2/llm_interface.py`: [Stable] 1.5 Flash ê¸°ë°˜ ì •ë°€ í‰ê°€ê¸° (404/429 í•˜ë“œë‹ ì™„ë£Œ)
- `hybrid_agent_v2/fast_cutter.py`: [Robust] Windows ê²½ë¡œ ë¬¸ì œ ë° ë³‘í•© ì—ëŸ¬ í•´ê²° ë²„ì „
